<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy Birthday, Саша</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap');

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Comic Neue', cursive, sans-serif;
    background-color: #000;
    overflow: hidden;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background-color 1s ease;
  }

  body.birthday-theme {
    background-color: #fff0f5;
    background-image: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M30,30 Q50,10 70,30 Q90,50 70,70 Q50,90 30,70 Q10,50 30,30 Z" fill="%23ffb6c1" opacity="0.3"/></svg>');
    background-repeat: repeat;
  }

  .intro-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 100;
  }

  .intro-text {
    position: absolute;
    font-size: 3rem;
    font-weight: bold;
    text-align: center;
    color: white;
    opacity: 0;
  }

  .balloon {
    position: absolute;
    width: 60px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-weight: bold;
    font-size: 1.5rem;
    z-index: 10;
    transform: translateY(100vh);
  }

  .balloon-string {
    position: absolute;
    width: 2px;
    height: 50px;
    background-color: rgba(255,255,255,0.5);
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
  }

  .magazine {
    width: 800px;
    height: 500px;
    position: relative;
    perspective: 2000px;
    display: none;
    opacity: 0;
    transform: scale(0.9);
    transition: opacity 1s ease, transform 1s ease;
  }

  .magazine.show {
    opacity: 1;
    transform: scale(1);
  }

  .cover {
    position: absolute;
    width: 100%;
    height: 100%;
    background: #fff8dccc;
    border-radius: 15px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.15);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    backface-visibility: hidden;
    transform-origin: left center;
    transition: transform 1.2s ease-in-out;
    z-index: 2;
    overflow: hidden;
  }

  .cover.open {
    transform: rotateY(-180deg);
  }

  .special-text {
    font-size: 1.4rem;
    margin-bottom: 2rem;
    font-weight: 700;
    color: #cc6699;
    text-align: center;
    z-index: 1;
  }

  .cake-container {
    position: relative;
    width: 200px;
    height: 150px;
    margin-bottom: 2rem;
    z-index: 1;
  }

  .cake-layer {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    transition: all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    opacity: 0;
  }

  .layer1 {
    bottom: 0;
    width: 200px;
    height: 50px;
    background: linear-gradient(to bottom, #d2691e, #f4a460);
    transform: translateX(-50%) translateY(-500px);
    animation: drop 0.8s ease-out 0.2s forwards;
  }

  .layer2 {
    bottom: 50px;
    width: 150px;
    height: 40px;
    background: linear-gradient(to bottom, #f4a460, #deb887);
    transform: translateX(-50%) translateY(-500px);
    animation: drop 0.8s ease-out 0.4s forwards;
  }

  .layer3 {
    bottom: 90px;
    width: 100px;
    height: 30px;
    background: linear-gradient(to bottom, #deb887, #f5deb3);
    transform: translateX(-50%) translateY(-500px);
    animation: drop 0.8s ease-out 0.6s forwards;
  }

  /* New cream topping */
  .cream-topping {
    position: absolute;
    left: 50%;
    bottom: 120px;
    width: 120px;
    height: 20px;
    background: linear-gradient(to bottom, #fff, #f8f8f8);
    border-radius: 15px;
    transform: translateX(-50%) translateY(-500px);
    animation: drop 0.8s ease-out 0.8s forwards;
    z-index: 3;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }

  /* Cream swirls */
  .cream-swirl {
    position: absolute;
    width: 20px;
    height: 20px;
    background: white;
    border-radius: 50%;
    z-index: 4;
  }
  
  .swirl1 {
    bottom: 130px;
    left: 45%;
    animation: swirlDrop 0.8s ease-out 1.0s forwards;
  }
  
  .swirl2 {
    bottom: 130px;
    left: 55%;
    animation: swirlDrop 0.8s ease-out 1.1s forwards;
  }
  
  .swirl3 {
    bottom: 125px;
    left: 50%;
    animation: swirlDrop 0.8s ease-out 1.2s forwards;
  }

  @keyframes swirlDrop {
    from { transform: translateY(-100px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  @keyframes drop {
    to {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
  }

  .candle {
    position: absolute;
    bottom: 140px;
    left: 50%;
    transform: translateX(-50%);
    width: 10px;
    height: 30px;
    background: linear-gradient(to bottom, #ff4500, #ff6347);
    border-radius: 2px;
    z-index: 5;
    opacity: 0;
    animation: fadeIn 0.5s ease-out 1.4s forwards;
  }

  .flame {
    position: absolute;
    top: -18px;
    left: 50%;
    transform: translateX(-50%);
    width: 14px;
    height: 14px;
    background: radial-gradient(circle, rgba(255,255,0,0.9) 0%, rgba(255,165,0,0.8) 60%, rgba(255,69,0,0.6) 100%);
    border-radius: 50% 20% 50% 50%;
    animation: flicker 0.15s infinite alternate ease-in-out;
    filter: blur(1px);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
  }

  @keyframes flicker {
    from { transform: translateX(-50%) scale(1) rotate(-5deg); opacity: 0.9; }
    to { transform: translateX(-50%) scale(1.3) rotate(5deg); opacity: 1; }
  }

  @keyframes fadeIn {
    to { opacity: 1; }
  }

  .decoration {
    position: absolute;
    border-radius: 50%;
    z-index: 3;
  }

  .sprinkle1 {
    width: 8px;
    height: 8px;
    background: #ff69b4;
    bottom: 125px;
    left: 45%;
    animation: sprinkleDrop 0.8s ease-out 1.0s forwards;
  }

  .sprinkle2 {
    width: 10px;
    height: 10px;
    background: #9370db;
    bottom: 130px;
    left: 55%;
    animation: sprinkleDrop 0.8s ease-out 1.1s forwards;
  }

  .sprinkle3 {
    width: 7px;
    height: 7px;
    background: #ffa500;
    bottom: 122px;
    left: 50%;
    animation: sprinkleDrop 0.8s ease-out 1.2s forwards;
  }

  @keyframes sprinkleDrop {
    from { transform: translateY(-100px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .cake-text {
    font-size: 1.2rem;
    font-weight: 700;
    color: #cc6699;
    text-align: center;
    z-index: 1;
  }

  .click-open {
    margin-top: 2rem;
    padding: 0.6rem 1.2rem;
    font-size: 1rem;
    cursor: pointer;
    border-radius: 6px;
    border: none;
    background-color: #cc6699;
    color: white;
    font-weight: 600;
    transition: all 0.3s ease;
    z-index: 1;
  }

  .click-open:hover {
    background-color: #b04f80;
    transform: scale(1.05);
  }

  .pages {
    position: absolute;
    width: 100%;
    height: 100%;
    display: flex;
    z-index: 1;
  }

  .left-page, .right-page {
    width: 50%;
    height: 100%;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
    display: flex;
    justify-content: center;
    align-items: center;
    backface-visibility: hidden;
  }

  .left-page {
    border-radius: 15px 0 0 15px;
    transform-origin: right center;
    transform: rotateY(180deg);
    opacity: 0;
    transition: opacity 0.5s ease 0.6s, transform 1.2s ease-in-out;
    background: linear-gradient(135deg, #ffcce6 0%, #ff99cc 50%, #ff66b3 100%);
    position: relative;
    overflow: hidden;
  }

  .left-page::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M30,30 Q50,10 70,30 Q90,50 70,70 Q50,90 30,70 Q10,50 30,30 Z" fill="%23ffffff" opacity="0.2"/></svg>');
    background-repeat: repeat;
    z-index: 0;
  }

  .right-page {
    border-radius: 0 15px 15px 0;
    overflow: hidden;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
  }

  .open ~ .pages .left-page {
    transform: rotateY(0deg);
    opacity: 1;
  }

  .message {
    text-align: center;
    padding: 2rem;
    position: relative;
    z-index: 1;
  }

  .message .main {
    font-size: 2.2rem;
    font-weight: 700;
    color: #fff;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    background: linear-gradient(to right, #ff66b3, #ff3385);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1rem;
  }

  .message .secondary {
    font-size: 1.8rem;
    font-weight: 600;
    color: #fff;
    opacity: 0.9;
  }

  #fireworksCanvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
  }

  #heartContainer {
    position: absolute;
    width: 100%;
    height: 100%;
    z-index: 2;
    opacity: 0;
    transition: opacity 1s ease;
  }

  #heartContainer.show {
    opacity: 1;
  }

  .permanent-heart {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 150px;
    height: 150px;
    background: radial-gradient(circle, #ff3366 0%, #cc0044 100%);
    clip-path: path('M 75,30 C 90,0 135,0 135,50 C 135,90 105,120 75,150 C 45,120 15,90 15,50 C 15,0 60,0 75,30 Z');
    box-shadow: 0 0 30px rgba(255, 51, 102, 0.7);
    z-index: 3;
    opacity: 0;
    animation: heartPulse 2s infinite;
  }

  @keyframes heartPulse {
    0% { transform: translate(-50%, -50%) scale(1); }
    50% { transform: translate(-50%, -50%) scale(1.1); }
    100% { transform: translate(-50%, -50%) scale(1); }
  }

  .confetti-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 10;
  }
</style>
</head>
<body>

<div class="intro-container" id="introContainer">
  <div class="intro-text" id="introText">Happy Birthday Саша!</div>
</div>

<div class="magazine" id="magazine">
  <div class="cover" id="cover">
    <div class="special-text">A special card just for you</div>
    
    <div class="cake-container">
      <div class="cake-layer layer1"></div>
      <div class="cake-layer layer2"></div>
      <div class="cake-layer layer3"></div>
      <div class="cream-topping"></div>
      <div class="cream-swirl swirl1"></div>
      <div class="cream-swirl swirl2"></div>
      <div class="cream-swirl swirl3"></div>
      <div class="decoration sprinkle1"></div>
      <div class="decoration sprinkle2"></div>
      <div class="decoration sprinkle3"></div>
      <div class="candle"><div class="flame"></div></div>
    </div>
    
    <div class="cake-text">Happy Birthday, Саша</div>
    <button class="click-open" id="openBtn">Click here to open</button>
  </div>
  
  <div class="pages">
    <div class="left-page">
      <div class="message">
        <div class="main">Wishing you the best<br>and may all your<br>wishes come true!</div>
        <div class="secondary">I just wanted to wish you a sweet and cherishing birthday and I did wanted to make it special.</div>
      </div>
    </div>
    <div class="right-page">
      <canvas id="fireworksCanvas"></canvas>
      <div id="heartContainer"></div>
      <div class="permanent-heart" id="permanentHeart"></div>
    </div>
  </div>
</div>

<canvas class="confetti-canvas" id="confettiCanvas"></canvas>

<script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js'></script>
<script src='https://unpkg.co/gsap@3/dist/gsap.min.js'></script>

<script>
  // Intro animation
  const introContainer = document.getElementById('introContainer');
  const introText = document.getElementById('introText');
  const magazine = document.getElementById('magazine');
  const body = document.body;
  const permanentHeart = document.getElementById('permanentHeart');

  // Balloon colors
  const balloonColors = [
    '#ff5a8a', '#ff8a5a', '#5a8aff', '#8a5aff',
    '#5aff8a', '#ffcc5a', '#5affcc', '#cc5aff'
  ];

  // Create balloons with more space between them
  function createBalloonAnimation() {
    const text = 'Happy Birthday Саша!';
    const letters = text.split('');
    const centerX = window.innerWidth / 2 - (letters.length * 50) / 2;
    
    introText.style.left = `${centerX}px`;
    introText.style.top = '50%';
    introText.style.transform = 'translateY(-50%)';
    
    letters.forEach((letter, index) => {
      if (letter === ' ') return;
      
      const balloon = document.createElement('div');
      balloon.className = 'balloon';
      balloon.textContent = letter;
      balloon.style.left = `${centerX + index * 50}px`;
      balloon.style.backgroundColor = balloonColors[index % balloonColors.length];
      
      const string = document.createElement('div');
      string.className = 'balloon-string';
      balloon.appendChild(string);
      introContainer.appendChild(balloon);
      
      gsap.to(balloon, {
        y: '-=80vh',
        duration: 2,
        delay: index * 0.1,
        ease: 'back.out(1)'
      });
      
      if (index === letters.length - 1) {
        setTimeout(() => {
          introText.style.opacity = '1';
          
          setTimeout(() => {
            gsap.to(introText, {
              y: '-=100vh',
              opacity: 0,
              duration: 1.5,
              ease: 'power1.in'
            });
            
            document.querySelectorAll('.balloon').forEach((balloon, i) => {
              gsap.to(balloon, {
                y: `-=${100 + Math.random() * 100}vh`,
                x: `${(Math.random() - 0.5) * 200}px`,
                opacity: 0,
                duration: 1.5,
                delay: i * 0.05,
                ease: 'power1.in',
                onComplete: () => balloon.remove()
              });
            });
            
            setTimeout(() => {
              introContainer.style.display = 'none';
              magazine.style.display = 'block';
              body.classList.add('birthday-theme');
              
              setTimeout(() => {
                magazine.classList.add('show');
                startFireworks();
              }, 100);
            }, 1500);
          }, 2000);
        }, 2000);
      }
    });
  }

  createBalloonAnimation();

  // Main card functionality
  const cover = document.getElementById('cover');
  const openBtn = document.getElementById('openBtn');
  const fireworksCanvas = document.getElementById('fireworksCanvas');
  const confettiCanvas = document.getElementById('confettiCanvas');
  const confettiCtx = confettiCanvas.getContext('2d');
  const heartContainer = document.getElementById('heartContainer');

  function resizeCanvases() {
    fireworksCanvas.width = fireworksCanvas.clientWidth;
    fireworksCanvas.height = fireworksCanvas.clientHeight;
    confettiCanvas.width = window.innerWidth;
    confettiCanvas.height = window.innerHeight;
  }
  
  window.addEventListener('resize', resizeCanvases);
  resizeCanvases();

  openBtn.addEventListener('click', () => {
    cover.classList.add('open');
    startConfetti();
  });

  // Fireworks animation: Single firework that explodes into a heart
  function startFireworks() {
    const ctx = fireworksCanvas.getContext('2d');
    const centerX = fireworksCanvas.width / 2;
    const centerY = fireworksCanvas.height / 2;
    
    // Create the rocket
    let rocket = {
      x: centerX,
      y: fireworksCanvas.height + 50,
      targetY: fireworksCanvas.height * 0.4,
      speed: 4,
      radius: 4,
      color: '#ffffff'
    };
    
    // Create particles array
    let particles = [];
    
    // Heart shape points
    const heartPoints = [];
    for (let t = 0; t <= Math.PI * 2; t += 0.01) {
      const x = 16 * Math.pow(Math.sin(t), 3);
      const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
      heartPoints.push({
        x: centerX + x * 8,
        y: centerY - y * 8
      });
    }
    
    // Animation loop
    function animate() {
      ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
      ctx.fillRect(0, 0, fireworksCanvas.width, fireworksCanvas.height);
      
      // Move and draw the rocket
      if (rocket) {
        rocket.y -= rocket.speed;
        
        // Draw rocket with trail
        ctx.beginPath();
        ctx.moveTo(rocket.x, rocket.y + 15);
        ctx.lineTo(rocket.x, rocket.y);
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.7)';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        ctx.beginPath();
        ctx.arc(rocket.x, rocket.y, rocket.radius, 0, Math.PI * 2);
        ctx.fillStyle = rocket.color;
        ctx.fill();
        
        // Explode when rocket reaches target
        if (rocket.y <= rocket.targetY) {
          // Create explosion particles
          for (let i = 0; i < 150; i++) {
            const angle = Math.random() * Math.PI * 2;
            const speed = Math.random() * 5 + 2;
            particles.push({
              x: rocket.x,
              y: rocket.y,
              radius: Math.random() * 3 + 1,
              color: `hsl(${Math.random() * 60 + 330}, 100%, 50%)`,
              vx: Math.cos(angle) * speed,
              vy: Math.sin(angle) * speed,
              life: 100
            });
          }
          rocket = null;
        }
      }
      
      // Draw particles
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        
        // Move particle
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.05; // Gravity
        p.life--;
        
        // Remove dead particles
        if (p.life <= 0 || p.y > fireworksCanvas.height) {
          particles.splice(i, 1);
          continue;
        }
        
        // Draw particle
        const alpha = Math.min(1, p.life / 100);
        ctx.globalAlpha = alpha;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
        ctx.fillStyle = p.color;
        ctx.fill();
      }
      ctx.globalAlpha = 1;
      
      // Draw heart outline after explosion
      if (!rocket && particles.length > 0) {
        ctx.beginPath();
        for (let i = 0; i < heartPoints.length; i++) {
          const p = heartPoints[i];
          if (i === 0) ctx.moveTo(p.x, p.y);
          else ctx.lineTo(p.x, p.y);
        }
        ctx.closePath();
        ctx.strokeStyle = 'rgba(255, 105, 180, 0.3)';
        ctx.lineWidth = 2;
        ctx.stroke();
      }
      
      // When particles are gone, show permanent heart
      if (!rocket && particles.length === 0) {
        permanentHeart.style.opacity = '1';
        return; // Stop animation
      }
      
      requestAnimationFrame(animate);
    }
    
    animate();
  }

  // Confetti animation
  let confettiPieces = [];

  function createConfetti() {
    const colors = [
      "#ff5a8a", "#ff8a5a", "#5a8aff", "#8a5aff", 
      "#5aff8a", "#ffcc5a", "#5affcc", "#cc5aff"
    ];

    confettiPieces = Array.from({ length: 150 }, () => ({
      x: Math.random() * confettiCanvas.width,
      y: Math.random() * confettiCanvas.height - confettiCanvas.height,
      w: Math.random() * 10 + 5,
      h: Math.random() * 10 + 5,
      color: colors[Math.floor(Math.random() * colors.length)],
      speed: 2 + Math.random() * 3,
      angle: Math.random() * Math.PI * 2,
      rotation: Math.random() * Math.PI * 2,
      rotationSpeed: (Math.random() - 0.5) * 0.2
    }));
  }

  function animateConfetti() {
    confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
    
    confettiPieces.forEach(p => {
      p.y += p.speed;
      p.rotation += p.rotationSpeed;
      
      if(p.y > confettiCanvas.height) {
        p.y = -10;
        p.x = Math.random() * confettiCanvas.width;
      }
      
      confettiCtx.save();
      confettiCtx.translate(p.x + p.w/2, p.y + p.h/2);
      confettiCtx.rotate(p.rotation);
      confettiCtx.fillStyle = p.color;
      confettiCtx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      confettiCtx.restore();
    });
    
    requestAnimationFrame(animateConfetti);
  }

  function startConfetti() {
    createConfetti();
    animateConfetti();
  }
</script>
</body>
</html>